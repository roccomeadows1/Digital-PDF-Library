<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Download Book – Free ( PDF ePub MOBI )</title>
<meta name="description" content="Download books for free in PDF, EPUB and MOBI formats.">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="canonical" id="canonical-link" href="https://bookreads.pages.dev/">

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"
  crossorigin="anonymous"></script>

<style>
:root {
  --bg:#f5f6f8;--card:#fff;--text:#111;--muted:#555;--primary:#2563eb;
}
body {
  margin:0;background:var(--bg);font-family:system-ui;color:var(--text);
}
.container {
  max-width:900px;margin:3rem auto;padding:0 1rem;
}
.card {
  display:flex;gap:2rem;background:var(--card);border-radius:16px;
  padding:2rem;box-shadow:0 10px 30px rgba(0,0,0,.08);
}
.cover img { width:180px;border-radius:12px }
.meta h1 { margin:0 0 .5rem;font-size:2rem }
.meta p { margin:.25rem 0;color:var(--muted) }
.rating { margin:.75rem 0;font-weight:600 }
.button {
  display:inline-block;background:var(--primary);color:#fff;
  padding:12px 20px;border-radius:10px;text-decoration:none;font-weight:600;
}
@media (max-width:700px){
  .card{flex-direction:column;text-align:center}
  .cover img{margin:0 auto}
}
</style>
</head>
<body>

<div class="container">
  <div class="card">
    <div class="cover">
      <img id="book-cover" alt="">
    </div>
    <div class="meta">
      <h1 id="site-title">Loading…</h1>
      <p id="site-description"></p>
      <div class="rating" id="book-rating"></div>
      <a id="download-btn" class="button" href="#">Download</a>
    </div>
  </div>
</div>

<!-- PDF MODAL -->
<div id="pdf-modal" style="display:none;position:fixed;inset:0;
background:rgba(0,0,0,.8);z-index:9999;align-items:center;justify-content:center">
  <div style="width:95%;height:95%;background:#000;border-radius:16px;
  overflow:hidden;position:relative">

    <button id="pdf-close"
      style="position:absolute;top:10px;right:10px;background:#111;
      color:#fff;border:0;padding:6px 10px;border-radius:6px;cursor:pointer">✕</button>

    <!-- TOP AD -->
    <div style="height:60px;display:flex;align-items:center;justify-content:center;background:#000">
      <div style="width:480px;height:60px;background:#222;color:#aaa;
      display:flex;align-items:center;justify-content:center">
        480×60 Banner Ad
      </div>
    </div>

    <div id="pdf-pages"
      style="height:calc(100% - 60px);overflow:auto;background:#111;padding:1rem">
    </div>
  </div>
</div>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
 "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

const SITE_URL="https://bookreads.pages.dev";
const params=new URLSearchParams(location.search);
const isbn=params.get("isbn");

const modal=document.getElementById("pdf-modal");
const closeBtn=document.getElementById("pdf-close");
const downloadBtn=document.getElementById("download-btn");
const pages=document.getElementById("pdf-pages");

const AD_EVERY_PAGES=3;

function createAd(){
  const d=document.createElement("div");
  d.style.cssText="display:flex;justify-content:center;margin:24px 0";
  d.innerHTML=`<div style="width:480px;height:60px;background:#222;color:#aaa;
  display:flex;align-items:center;justify-content:center">
  480×60 Banner Ad</div>`;
  return d;
}

async function renderPDF(url){
  pages.innerHTML="";
  const pdf=await pdfjsLib.getDocument(url).promise;
  for(let i=1;i<=pdf.numPages;i++){
    const page=await pdf.getPage(i);
    const v=page.getViewport({scale:1.3});
    const c=document.createElement("canvas");
    c.width=v.width;c.height=v.height;
    c.style.display="block";c.style.margin="0 auto 24px";
    await page.render({canvasContext:c.getContext("2d"),viewport:v}).promise;
    pages.appendChild(c);
    if(i%AD_EVERY_PAGES===0 && i!==pdf.numPages){
      pages.appendChild(createAd());
    }
  }
}

fetch("/data.json").then(r=>r.json()).then(async DATA=>{
  if(!isbn||!DATA.books[isbn]){
    document.getElementById("site-title").textContent="Book not found";
    return;
  }
  document.getElementById("canonical-link").href=
    `${SITE_URL}/?isbn=${isbn}`;

  const book=await fetch(`/api/books?isbn=${isbn}`).then(r=>r.json());

  document.title=
    `Download ${book.title} by ${book.author} – Free ( PDF ePub MOBI )`;

  document.querySelector('meta[name="description"]').content=
    `Download ${book.title} by ${book.author} for free. PDF EPUB MOBI.`;

  site-title.textContent=book.title;
  site-description.textContent=`by ${book.author}`;
  book-rating.textContent="★★★★★ "+book.rating;
  book-cover.src=book.cover;
  downloadBtn.href=DATA.books[isbn].download;
});

downloadBtn.onclick=e=>{
  e.preventDefault();
  modal.style.display="flex";
  renderPDF(downloadBtn.href);
};
closeBtn.onclick=()=>{
  modal.style.display="none";
  pages.innerHTML="";
};
</script>

</body>
</html>
